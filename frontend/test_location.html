<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Live Location</title>
</head>
<body>
  <h1>Testing Live Location Updates</h1>
  <p>Open the browser console to see logs.</p>

  <script>
    // Function to get the user's live location
    function getLiveLocation(driverId) {
      if (!navigator.geolocation) {
        console.error("Geolocation is not supported by your browser.");
        return;
      }

      navigator.geolocation.getCurrentPosition(
        async (position) => {
          const { latitude, longitude } = position.coords;

          console.log(`Fetched location: Latitude=${latitude}, Longitude=${longitude}`);

          // Send the location to the backend
          try {
            const response = await fetch(`http://localhost:5000/driverdetails/${driverId}`, {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                live_location: `${latitude},${longitude}`,
                availability: 1,
              }),
            });

            if (!response.ok) {
              console.error("Failed to update location:", response.statusText);
            } else {
              console.log("Location updated successfully");
            }
          } catch (error) {
            console.error("Error updating location:", error);
          }
        },
        (error) => {
          console.error("Error fetching location:", error.message);
        },

        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 } // Add this options object

      );
    }

    // Start sending location updates every 10 seconds
    const driverId = 'c6fc93a3-54d0-447b-98bd-51bd2a6df8ed'; // Replace with your unique driver ID
    setInterval(() => getLiveLocation(driverId), 10000); // Update every 10 seconds
  </script>
</body>
</html>